<link rel="stylesheet" type="text/css" href="https://religionandstory.com/common/css/modal.css"/>

<div id="councilModal" class="modal-wrapper">
    <div class="modal-foreground">
        <div class="modal-box">
            <div class="modal-header">
                <span id="modalHeader" class="subtitle">Council</span>
                <span id="close" class="close">&times;</span>
            </div>
            <div id="modalBody" class="modal-body">
                <div id="dimensions" style="margin-bottom: .5em"></div>
                <div>
                    <div><span style="font-weight: bold">Total: </span><span id="totalDimensionCost">0</span>WB</div>
                    <button id="purchase" class="button" style="margin-top: .4em; padding: .1em .5em" onclick="purchaseDimensions()">Purchase</button>
                </div>
            </div>
            <div id="modalSubmit" class="modal-submit center">
                <button id="closeButton" class="button" style="width: 10em" onclick="closeOutCouncilModal()">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-background"></div>
</div>

<script>
    let councilModalValues;
    let councilModalCallback;

    function openCouncilModal( currentPlayer, callback ) {
        councilModalValues = currentPlayer;
        councilModalCallback = callback;

        populateDimensionCheckboxes();

        id("councilModal").style.display = "block";
        setCloseHandlersJS( "councilModal" );
        blurBackground();
    }

    function populateDimensionCheckboxes() {
        let wrapper = id( 'dimensions' );
        wrapper.innerHTML = "";
        for ( let i = 0; i < DIMENSIONS.length; i++ ) {
            const dimension = DIMENSIONS[i];
            const id = "dimension" + i;
            let div = document.createElement( "DIV" );
            let input = document.createElement( "INPUT" );
            input.id = id;
            input.name = "dimensions";
            input.type = "checkbox";
            input.onchange = dimensionChange;
            let label = document.createElement( "LABEL" );
            let cost = dimension.costFunction();
            label.for = id;
            label.innerHTML = dimension.name + " (" + cost + ") ";
            div.appendChild( input );
            div.appendChild( label );
            wrapper.appendChild( div );
        }
    }

    function dimensionChange() {
        let total = 0;
        let dimensionChecks = nm('dimensions');
        for ( let i = 0; i < dimensionChecks.length; i++ ) {
            if ( dimensionChecks[i].checked ) {
                total += Dimension.getCost();
            }
        }
        id('totalDimensionCost').innerText = total + "";
    }

    function purchaseDimensions() {
        const councilTotal = parseInt( id('totalDimensionCost').innerText );
        if ( councilTotal > councilModalValues.warBucks ) {
            showToaster( "Cannot afford purchase" );
        }
        else {
            councilModalValues.warBucks -= councilTotal;
            closeOutCouncilModal();
        }
    }

    function closeOutCouncilModal() {
        closeModalJS( "councilModal" );
        councilModalCallback( councilModalValues );
    }
</script>